<!DOCTYPE html>
<html lang="en" xmlns:hx-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Scroll Grid</title>
    <style>
        @media (min-width: 1001px) {
            .grid {
                grid-template-columns: repeat(16, 50px);
            }
        }

        @media (max-width: 1000px) and (min-width: 501px) {
            .grid {
                grid-template-columns: repeat(8, 50px);
            }
        }

        @media (max-width: 500px) {
            .grid {
                grid-template-columns: repeat(4, 50px);
            }
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }

        .grid {
            display: grid;
            gap: 5px;
            margin: 5px;
        }

        .box {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #f0f0f0;
            cursor: pointer;
        }

        .message {
            font-size: 24px;
            color: #337599;
            font-weight: bold;
            margin: 10px;
        }
    </style>
    <script src="https://unpkg.com/htmx.org@2.0.1"></script>
</head>
<body>
<div id="grid-container">
    <div id="topspacer"></div>
    <div id="0"
         class="grid"
         hx-get="/scroll?batch=0"
         hx-trigger="load delay:50ms"
         hx-swap="outerHTML"></div>
    <div id="bottomspacer"></div>
</div>
</body>

<script>
    let lastElement;

    function captureScrollPosition(evt) {
        // console.log("!   hx-on:htmx:before-request='captureScrollPosition()' fired");
        if (evt.detail.elt.getAttribute('hx-swap') === 'beforebegin') {
            // console.log("    captureScrollPosition: hx-swap is beforebegin; setting lastElement");
            lastElement = evt.target;
            // console.log("---> lastElement value:", lastElement);
        }
    }

    document.body.addEventListener('htmx:afterSwap', function (evt) {
        // console.log("*   eventlistener on afterSwap triggers");
        // console.log("    evt.detail.target.getAttribute('hx-swap') value: ");
        // console.log(evt.detail.target.getAttribute('hx-swap'));

        if (evt.detail.target.getAttribute('hx-swap') === 'beforebegin') {
            console.log("    eventlistener on afterSwap: hx-swap is beforebegin && lastElement; scrolling to lastElement");
            console.log("---> lastElement value: ", lastElement);
            // lastElement.scrollIntoView({ behavior: "smooth", block: "end"});
            // console.log("     finished scrolling lastElement into view.");
            console.log("*** turned off, debug *** ");
        }
    });
</script>

</html>
